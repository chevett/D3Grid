var d3G=d3G||{};d3G.Grid=function(n){function r(n){if(typeof n.dataUrl!="string")throw"d3G.Grid: `dataUrl` must be a string (url)!";}function i(t){function s(){var r=n.extend({},e.getSortParameters(),i.getPageParameters());return typeof t.customParams=="function"&&(r=t.customParams(r)),r}function f(i){i=i||s(),n.ajax({url:t.dataUrl,data:i,dataType:"json",traditional:!0,type:"POST"}).done(function(n){u[i.PageIndex]=n,o(n)}).fail(function(){c()})}function o(n){e.render(n),i.render(n)}function c(){}function h(){var n=s();u[n.PageIndex]?o(u[n.PageIndex]):f(n)}d3.select(t.containerSelector).classed("d3g-container loading-content-container",!0),r(t);var e=d3G.Grid.Table.create(t),i=d3G.Grid.Pager.create(t),u;return e.sortColumnChanged.addHandler(function(){u={},i.reset(),f()}),i.pageChanged.addHandler(function(){h()}),i.pageSizeChanged.addHandler(function(){u={},i.reset(),f()}),{table:e,pager:i,render:function(){u={},i.reset(),f()}}}return{create:i}}(jQuery),d3G=d3G||{},d3G.Grid=d3G.Grid||{},d3G.Grid.Table=function(n,t){function f(n){if(n.tableTitle)var i=t.select(n.containerSelector).insert("div",n.tableSelector).classed("d3g-header",!0).append("span").attr("id",n.tableSelector.replace(/#/gi,"")+"Header").html(n.tableTitle)}function u(n){var t=n.tableStyling,i="table d3g-table",f=typeof t!="undefined"&&typeof t.bordered!="undefined"?t.bordered:!0,e=typeof t!="undefined"&&typeof t.bordered!="undefined"?t.condensed:!1,r=typeof t!="undefined"&&typeof t.striped!="undefined"?t.striped:!0,u=typeof t!="undefined"&&typeof t.hovered!="undefined"?t.hovered:!0;return i+=f?" table-bordered":"",i+=e?" table-condensed":"",i+=r?" table-striped":"",i+=u?" table-hovered":""}function r(i){f(i),n(i.tableSelector).wrap('<div class="d3g-table-wrapper" />');var s=n.Callbacks(),o=i.defaultSortColumn||"",e=i.defaultSortDirection&&i.defaultSortDirection==="Descending"?!1:!0,r={PlainText:function(n){return n},Number:function(n){return n},Currency:function(n){return n},Html:function(t){return n("<div />").html(t).text()},Handlebars:function(){var t={};return function(i,r){var u=t[i]||(t[i]=Handlebars.compile(n("<div />").html(i).text()));return u(r)}}()};r=n.extend(i.formatters||{},r);n(i.tableSelector).on("click","th.d3g-sortable",function(){var t=n(this),r=t.data("sort-column"),i=t.hasClass("d3g-sort-active");o=r,e=i?!e:!0,s.fire()});if(i.onCellClick)n(i.tableSelector).on("click","tbody tr td",function(){var n=this;i.onCellClick(n)});return{render:function(f){var h=n.grep(f.columns,function(n){return n.includeType=="Column"}),v=n(i.tableSelector);v.empty();var a=u(i),s=t.select(i.tableSelector).classed(a,!0),p=s.append("thead").classed("d3g-table-header",!0).append("tr").selectAll("th").data(h).enter().append("th").attr("class",function(n){var t="d3g-header-"+n.index;return n.isSortable===!0&&(t=t+" d3g-sortable"),n.sortColumnName==o&&(t=t+" d3g-sort-active",t=e?t+" d3g-sort-asc":t+" d3g-sort-desc"),t}).attr("data-sort-column",function(n){if(n.isSortable===!0)return n.sortColumnName}).html(function(n){var t=n.label;return n.isSortable===!0&&(t+='<span class="text-icon d3g-sort-icon"></span>'),t}),c=s.append("tbody"),l=c.selectAll("tr").data(f.rows).enter().append("tr"),y=l.selectAll("td").data(h).enter().append("td").attr("class",function(n){return"d3g-content-"+n.index}).html(function(n,t,i){var s=n.name,e=f.rows[i],o=e[s],u;return r.custom&&(u=r.custom[s],typeof u=="function")?u(o,e):(u=n.formatter,typeof u=="function")?u(o,e):r[n.format](o,e)})},sortColumnChanged:{addHandler:function(n){s.add(n)},removeHandler:function(n){s.remove(n)}},getSortParameters:function(){return{SortColumnName:o,SortOrder:e?"Ascending":"Descending"}}}}return{create:r}}(jQuery,d3),d3G=d3G||{},d3G.Grid=d3G.Grid||{},d3G.Grid.Pager=function(n,t){function r(i){function v(i){var a={classed:"d3g-pager-sizer-wrapper"},c={classed:"d3g-pager-sizer-text"},p={classed:"d3g-pager-sizer-select-wrapper"},y={classed:"d3g-pager-sizer"},v={classed:"d3g-pager-sizer-text-prepend"},u=r(i,a),w=r(u,c,"span"),s,o,f;w.text("Showing"),s=r(u,p),o=r(s,y,"select"),o.on("change",function(){t.event.preventDefault(),e=n(this).val(),h.fire()}).selectAll("option").data(l).enter().append("option").attr("val",function(n){return n}).text(function(n){return n}).filter(function(n){return n==e}).attr("selected","selected"),f=r(u,v,"span"),f.text("per page")}function p(n){var e={classed:"d3g-pager-nav"},i=[{Label:"First",Icon:"d3g-first",UpdatePageIndex:function(){u=0}},{Label:"Previous",Icon:"d3g-previous",UpdatePageIndex:function(){u!=0&&(u-=1)}},{Label:"Next",Icon:"d3g-next",UpdatePageIndex:function(){u!=f-1&&(u+=1)}},{Label:"Last",Icon:"d3g-last",UpdatePageIndex:function(){u=f-1}}],o=r(n,e);n.select(".d3g-pager-nav").selectAll("a").data(i).enter().append("a").attr("href","#").attr("class",function(n){return"text-icon "+n.Icon}).text(function(n){return n.Label}).on("click",function(n){t.event.preventDefault(),n.UpdatePageIndex(),s.fire()})}function w(i){var o={classed:"d3g-pager-fullscreen"},f={classed:"d3g-pager-fullscreen-message"},e=r(i,o,"a"),u;e.classed("icon",!0).text("fullscreen Mode").on("click",function(){t.event.preventDefault();var r=n(this).parents(".d3g-container");r.toggleClass("d3g-fullscreen"),n(window).bind("resize",function(){c(r)}),r.hasClass("d3g-fullscreen")?c(r):(n(".d3g-table-wrapper").css("height","auto"),n(window).unbind("resize"))});u=r(i,f),u.text("Press `ESC` To Exit Fullscreen Mode"),n(document).keyup(function(t){t.keyCode==27&&n(".d3g-container").removeClass("d3g-fullscreen")})}function b(n){var u={classed:"d3g-pager-message"},s=r(n,u),e=[{Selector:"d3g-pager-message-title",Content:"Page "},{Selector:"d3g-pager-message-input",Content:o},{Selector:"d3g-pager-seperator",Content:" of "},{Selector:"d3g-pager-message-total-pages",Content:f}],i=s.selectAll("span").data(e);i.enter().append("span").attr("class",function(n){return n.Selector}),i.text(function(n){return n.Content})}function y(n,t){var s={classed:"d3g-pager-toolbar"},e={classed:"d3g-pager-toolbar-tools"},u=r(n,s),o=r(u,e),f;t.footerText&&a(u,t.footerText),f=typeof i.canFullScreen!="undefined"?i.fullscreen:!0,f&&w(o)}function a(n,t){var i={classed:"d3g-pager-footer-text",content:t},u={},u=r(n,i);u.text(i.content)}function c(t){var f=n(i.pagerSelector).height(),u=n(".d3g-header"),r;u&&(f+=u.height()),r=n(window).height()-f,t.find(".d3g-table-wrapper").css("height",r)}function r(n,t,i){i=i||"div";var r=n.selectAll("."+t.classed).data([t]);return r.enter().append(i).attr("class",function(n){return n.classed}),r}var l=[10,20,50],u=0,e=l[0],s=n.Callbacks(),h=n.Callbacks(),f=0,o=0;return{render:function(n){var h={},c=[{classed:"d3g-pager-wrapper"}],l={classed:"d3g-pager-top-wrapper"},s={};h=t.select(i.pagerSelector).classed("d3g-pager",!0).selectAll("div").data(c),h.enter().append("div").attr("class",function(n){return n.classed}),s=r(h,l),f=Math.ceil(n.totalRowCount/e),o=u+1,p(s),v(s),b(s,n),y(h,n)},pageChanged:{addHandler:function(n){s.add(n)},removeHandler:function(n){s.remove(n)}},pageSizeChanged:{addHandler:function(n){h.add(n)},removeHandler:function(n){h.remove(n)}},getPageParameters:function(){return{PageIndex:u,PageSize:e}},reset:function(){f=0,o=1,u=0}}}return{create:r}}(jQuery,d3)